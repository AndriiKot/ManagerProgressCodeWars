{
  "id": "6530eec919435304ad32fe6a",
  "name": "Ranking Regional Sales Performance and Sales Positions Within Region",
  "slug": "ranking-regional-sales-performance-and-sales-positions-within-region",
  "category": "reference",
  "publishedAt": "2023-10-25T10:31:31.685Z",
  "approvedAt": "2023-10-27T08:14:46.505Z",
  "languages": [
    "sql"
  ],
  "url": "https://www.codewars.com/kata/6530eec919435304ad32fe6a",
  "rank": {
    "id": -5,
    "name": "5 kyu",
    "color": "yellow"
  },
  "createdAt": "2023-10-19T08:54:33.948Z",
  "createdBy": {
    "username": "bornForThis",
    "url": "https://www.codewars.com/users/bornForThis"
  },
  "approvedBy": {
    "username": "dfhwze",
    "url": "https://www.codewars.com/users/dfhwze"
  },
  "description": "You are given a dataset that captures daily sales amounts from various regions. Your task is to rank the regions based on the date they achieved their highest sales and then rank the sales within each region. \n\nThe `daily_sales` table is structured as follows:\n\n* `id` (integer): A unique identifier for each record.\n* `region_id` (integer): The identifier of the region where the sales occurred.\n* `sale_date` (date): The date the sales took place.\n* `sales_amount` (float): The sales amount for that particular day in the given region.\n\nWrite a SQL query that produces the following output:\n\n1) `region_id` (integer): The identifier of the region.\n2) `sale_date` (date): The date the sales took place.\n3) `sales_amount` (float): The sales amount for that particular day in the given region.\n4) `sales_rank_within_region` (integer): A rank assigned to each sale amount within its specific region. The highest sales for each region receive a rank of 1. If there's a tie in sales amount, we should rank by most recent sale date.\n5) `earliest_top_sale_rank` (integer): Rank of the regions based on the earliest date they achieved their highest sales (i.e., the sales with rank 1). In case two or more regions achieve their highest sales on the same date, the region with the bigger `region_id` should come first\n\nWe can assume that the `region_id` and `sale_date` combination will always be unique. The final output should be ordered first by `earliest_top_sale_rank`, then by `sales_rank_within_region` - both in ascending order. \n\nThus, for this sample data:\n\n```\n| id | region_id| sale_date  | sales_amount |\n+----+----------+------------+--------------+\n| 1  |    2     | 2023-01-01 |   3200.50    |\n| 2  |    2     | 2023-01-02 |   4200.75    |\n| 3  |    2     | 2023-01-04 |   2500.30    |\n| 4  |    3     | 2023-01-01 |   2900.90    |\n| 5  |    1     | 2023-01-03 |   3100.80    |\n```\n\nThe Expected Output is the following: \n\n```\n| region_id| sale_date  | sales_amount | sales_rank_within_region | earliest_top_sale_rank|\n+----------+------------+--------------+--------------------------+-----------------------+\n|    3     | 2023-01-01 |   2900.90    |            1             |          1            |\n|    2     | 2023-01-02 |   4200.75    |            1             |          2            |\n|    2     | 2023-01-01 |   3200.50    |            2             |          2            |\n|    2     | 2023-01-04 |   2500.30    |            3             |          2            |\n|    1     | 2023-01-03 |   3100.80    |            1             |          3            |\n```\n\n",
  "totalAttempts": 1140,
  "totalCompleted": 145,
  "totalStars": 12,
  "voteScore": 30,
  "tags": [
    "SQL",
    "Databases"
  ],
  "contributorsWanted": true,
  "unresolved": {
    "issues": 0,
    "suggestions": 0
  }
}