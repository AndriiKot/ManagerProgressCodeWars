{
  "id": "64bf9096d914b5000e0cc73b",
  "name": "Rolling Window Analysis of Customer Visits",
  "slug": "rolling-window-analysis-of-customer-visits",
  "category": "reference",
  "publishedAt": "2023-07-25T09:15:25.003Z",
  "approvedAt": "2023-07-27T12:30:59.999Z",
  "languages": [
    "sql"
  ],
  "url": "https://www.codewars.com/kata/64bf9096d914b5000e0cc73b",
  "rank": {
    "id": -6,
    "name": "6 kyu",
    "color": "yellow"
  },
  "createdAt": "2023-07-25T09:06:30.790Z",
  "createdBy": {
    "username": "bornForThis",
    "url": "https://www.codewars.com/users/bornForThis"
  },
  "approvedBy": {
    "username": "dfhwze",
    "url": "https://www.codewars.com/users/dfhwze"
  },
  "description": "You are given a PostgreSQL table named customers, which keeps track of customer visits. The schema for the `customers` table is as follows:\n\n* `date` (date): The date when the customer visited.\n* `customer_id` (integer): The unique ID for each customer.\n* `name` (text): The name of the customer.\n\nHere is some sample data:\n\n```\ndate      |customer_id| name   \n----------+-----------+-------\n2023-08-01| 1         | Andrew \n2023-08-02| 2         | Pete   \n2023-08-03| 2         | Andrew \n2023-08-04| 2         | Steve  \n2023-08-05| 2         | Stef   \n2023-08-06| 3         | Stef  \n2023-08-07| 1         | Jason \n2023-08-08| 1         | Jason \n```\n\nYour task is to write an SQL query that, for each row in the table, calculates the count of distinct names within the past two days (including the current day) for the same customer_id. The result should be ordered by the `date` in ascending order, then by `customer_id` in descending order, and finally by `name` in ascending order.\n\nThe output of your query should be all columns from `customers` table and count of integer type where the count of distinct names  is shown that share the same `customer_id` within the past two days (including the current day).\n\nSo thus the result of your query from the sample data abobe should look something like this:\n\n```\ndate      |customer_id| name  |count \n----------+-----------+-------+------\n2023-08-01| 1         |Andrew | 1 \n2023-08-02| 2         |Pete   | 1 \n2023-08-03| 2         |Andrew | 2 \n2023-08-04| 2         |Steve  | 3 \n2023-08-05| 2         |Stef   | 3 \n2023-08-06| 3         |Stef   | 1 \n2023-08-07| 1         |Jason  | 1 \n2023-08-08| 1         |Jason  | 1 \n```\n\nGLHF!\n\n\n",
  "totalAttempts": 849,
  "totalCompleted": 106,
  "totalStars": 9,
  "voteScore": 38,
  "tags": [
    "SQL",
    "Databases"
  ],
  "contributorsWanted": true,
  "unresolved": {
    "issues": 0,
    "suggestions": 0
  }
}