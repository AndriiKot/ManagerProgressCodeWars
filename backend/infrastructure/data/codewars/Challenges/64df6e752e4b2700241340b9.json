{
  "id": "64df6e752e4b2700241340b9",
  "name": " Integrated Medical Database Analysis: top medical plans used by patients",
  "slug": "integrated-medical-database-analysis-top-medical-plans-used-by-patients",
  "category": "reference",
  "publishedAt": "2023-08-19T15:05:07.026Z",
  "approvedAt": "2023-09-13T20:30:52.520Z",
  "languages": [
    "sql"
  ],
  "url": "https://www.codewars.com/kata/64df6e752e4b2700241340b9",
  "rank": {
    "id": -5,
    "name": "5 kyu",
    "color": "yellow"
  },
  "createdAt": "2023-08-18T13:13:25.936Z",
  "createdBy": {
    "username": "bornForThis",
    "url": "https://www.codewars.com/users/bornForThis"
  },
  "approvedBy": {
    "username": "dfhwze",
    "url": "https://www.codewars.com/users/dfhwze"
  },
  "description": "The Integrated Medical Database (IMD) aggregates patient data across multiple healthcare providers. Each record in the `plan_usage_summary` table represents the number of transactions (`total_trx_per_plan`) recorded for a particular medical plan (`plan_name`) for a specific IMD (`imd_id`). Some of these transactions don't have an associated plan and are represented with the plan name as \"0\".\n\n`plan_usage_summary` schema:\n\n* `id` (integer) - primary key\n* `imd_id` (integer) -\tThe ID of the Integrated Medical Database\n* `total_trx_per_plan` (float) - Total number of transactions for the plan\n* `plan_name`\t(varchar(255)) - Name of the medical plan. \"0\" means no specific plan\n\nYour task is to write an SQL query that provides insights into the top medical plans used by patients across various medical databases: \n\n1) For each `imd_id`, identify the top 3 medical plans based on the highest `total_trx_per_plan`.\n2) When identifying the top 3 plans, exclude rows where plan_name is \"0\".\n3) However, for calculating the proportion of transactions of each top medical plan, consider the total transactions of ALL plans (including those with `plan_name` = \"0\") associated with the respective `imd_id`.\n4) Calculate the proportion of transactions for each top medical plan with respect to the total transactions of the corresponding `imd_id`. This proportion should be rounded to 2 decimal places and be of `numeric` datatype.\n5) If there are fewer than 3 plans for an `imd_id` that can be included in the report (excluding the \"0\" plan), display NULL for the columns associated with the missing plan(s).\n6) It is guaranteed that there's at least one named plan for each `imd_id`. In other words, a situation where all plans are \"0\" plans is impossible.\n7) The ordering needs to be applied before rounding. As values for `total_trx_per_plan` are floating-point numbers with a lot of decimal places, we should not bother about ties - it is guaranteed that there will be no such cases in the tests.\n\n\nThe output should have the following columns:\n\n* `imd_id` (integer)\n* `top_first_plan` (varchar) - top named plan based on the highest `total_trx_per_plan`.\n* `top_first` (numeric) proportion of transactions for the top plan, rounded to 2 decimal places\n* `top_second_plan`(varchar/null)\n* `top_second` (numeric/null) - proportion of transactions for the second top plan, rounded to 2 decimal places\n* `top_third_plan` (varchar/null)\n* `top_third` - proportion of transactions for the third top plan, rounded to 2 decimal places\n\nAnd be ordered by `imd_id` in ascending order.\n\nGLHF!\n\n### Desired Output\n\nThe desired output should look like this:\n\n<table><!----><tr><th>imd_id</th><th>top_first_plan</th><th>top_first</th><th>top_second_plan</th><th>top_second</th><th>top_third_plan</th><th>top_third</th></tr><tr><td>1111005</td><td>Medicaid Illinois (Idpa)</td><td>0.79</td><td>Self Pay</td><td>0.05</td><td>Tricare North Region</td><td>0.05</td></tr><tr><td>1111531</td><td>Medicaid Al</td><td>0.53</td><td>Self Pay</td><td>0.04</td><td>Bcbs Federal</td><td>0.02</td></tr></table>\n\n\n",
  "totalAttempts": 1004,
  "totalCompleted": 140,
  "totalStars": 9,
  "voteScore": 54,
  "tags": [
    "SQL",
    "Databases"
  ],
  "contributorsWanted": true,
  "unresolved": {
    "issues": 0,
    "suggestions": 0
  }
}