{
  "id": "652eac1a3a9be51b35dbfbbb",
  "name": "Analyzing Backup Intervals and Restarts in AWS Clusters",
  "slug": "analyzing-backup-intervals-and-restarts-in-aws-clusters",
  "category": "reference",
  "publishedAt": "2023-10-18T10:43:00.043Z",
  "approvedAt": "2023-10-25T20:23:14.005Z",
  "languages": [
    "sql"
  ],
  "url": "https://www.codewars.com/kata/652eac1a3a9be51b35dbfbbb",
  "rank": {
    "id": -5,
    "name": "5 kyu",
    "color": "yellow"
  },
  "createdAt": "2023-10-17T15:45:30.825Z",
  "createdBy": {
    "username": "bornForThis",
    "url": "https://www.codewars.com/users/bornForThis"
  },
  "approvedBy": {
    "username": "dfhwze",
    "url": "https://www.codewars.com/users/dfhwze"
  },
  "description": "Product IT Company uses AWS clusters for its operations and employs SSD-backed volumes within these clusters for regular data backups. Each cluster has a unique ID, and handles a series of backup tasks. Occasionally, backups on a cluster are restarted due to various reasons, leading to multiple 'Start' events before an 'End' event is logged for a backup task. Your role is to analyze the backup logs, ensuring each start event pairs with an end, and derive insights from these events.\n\nWe have `backup_events` table:\n\n* `id`\t(integer) - primary key.\n* `event_datetime` (timestamp) - \tThe date and time of the backup event.\n* `aws_cluster_id`\t(integer) -\tA unique identifier for each AWS cluster.\n* `backup_status`\t(text) - Either 'Start' or 'End', indicating the backup event's status.\n\nFrom the given database table, write an SQL query to:\n\n1) Pair each backup start time with its corresponding end time.\n2) Calculate the total duration of the backup.\n3) Determine the number of restarts within each backup event.\n4) Order the results by `start_time` in ascending order, and in the case of a tie - by `aws_cluster_id` also in asc order.\n\nAssumptions:\n\n* There are no overlaps in the time frames for a given `aws_cluster_id`, meaning that a backup will end before another begins.\n* An 'End' event will always follow a 'Start' event for the same `aws_cluster_id`, but there may be multiple 'Start' events before an 'End' event if there are restarts.\n\nYour resultant dataset should have:\n\n1) `start_time` (text) -\tThe timestamp of the backup start.\n2) `end_time`\t(text)  -\tThe timestamp of the backup end.\n3) `aws_cluster_id`\t(integer) - A unique identifier for the AWS cluster.\n4) `total_backup_duration` - (interval) - Total time from start to end of the backup.\n5) `number_of_restarts` -\t(integer) -\tCount of backup restarts within the respective backup duration.\n\nFor this sample data:\n\n```\n id | event_datetime        | aws_cluster_id | backup_status\n----+-----------------------+----------------+---------------\n 1  | 2023-07-09 03:00:00   | 33             | Start\n 2  | 2023-07-09 03:05:00   | 34             | Start\n 3  | 2023-07-09 03:10:00   | 35             | Start\n 4  | 2023-07-09 04:05:00   | 34             | End\n 5  | 2023-07-09 04:10:00   | 33             | Start\n 6  | 2023-07-09 05:05:00   | 33             | End\n 7  | 2023-07-09 05:10:00   | 34             | Start\n 8  | 2023-07-09 06:00:00   | 34             | End\n 9  | 2023-07-10 04:00:00   | 35             | Start\n10  | 2023-07-10 05:00:00   | 35             | Start \n11  | 2023-07-11 05:00:00   | 35             | End\n```\n\nThe expected output is the following: \n\n```\n start_time        | end_time          | aws_cluster_id | total_backup_duration | number_of_restarts\n-------------------+-------------------+---------+-----------------------+-------------------\n 2023-07-09 03:00  | 2023-07-09 05:05  | 33             | 02:05:00              | 1\n 2023-07-09 03:05  | 2023-07-09 04:05  | 34             | 01:00:00              | 0\n 2023-07-09 03:10  | 2023-07-11 05:00  | 35             | 2 days 01:50:00       | 2\n 2023-07-09 05:10  | 2023-07-09 06:00  | 34             | 00:50:00              | 0\n ```\n \n GLHF!\n\n\n",
  "totalAttempts": 793,
  "totalCompleted": 85,
  "totalStars": 12,
  "voteScore": 30,
  "tags": [
    "SQL",
    "Databases"
  ],
  "contributorsWanted": true,
  "unresolved": {
    "issues": 0,
    "suggestions": 0
  }
}