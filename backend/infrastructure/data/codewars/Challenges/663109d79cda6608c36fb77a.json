{
  "id": "663109d79cda6608c36fb77a",
  "name": " Uncovering ABC Kata Solutions' Most Extravagant Departmental Expenses",
  "slug": "uncovering-abc-kata-solutions-most-extravagant-departmental-expenses",
  "category": "reference",
  "publishedAt": "2024-04-30T15:10:34.099Z",
  "approvedAt": "2024-05-01T05:37:29.327Z",
  "languages": [
    "sql"
  ],
  "url": "https://www.codewars.com/kata/663109d79cda6608c36fb77a",
  "rank": {
    "id": -7,
    "name": "7 kyu",
    "color": "white"
  },
  "createdAt": "2024-04-30T15:10:15.403Z",
  "createdBy": {
    "username": "bornForThis",
    "url": "https://www.codewars.com/users/bornForThis"
  },
  "approvedBy": {
    "username": "dfhwze",
    "url": "https://www.codewars.com/users/dfhwze"
  },
  "description": "As ABC Kata Solutions celebrates its 10th anniversary, the company reflects on a decade of significant growth and innovation. In the spirit of this milestone, the CFO has initiated a challenge to uncover the departments with the most creatively extravagant expenses over the years. From golden toilet seats to confetti cannons, ABC Kata Solutions' expense reports reveal a history of unorthodox spending. The task is to analyze financial data and identify the top five departments responsible for these exceptional expenditures, highlighting the company's unique corporate culture as it embarks on another decade of success.\n\nWe have `departments` table: \n\n* `department_id` (integer, primary key): Unique identifier for the department.\n* `department_name` (string, unique): Name of the department.\n\nand `expenses` table: \n\n* `expense_id` (integer, primary key): Unique identifier for the expense.\n* `department_id` (integer, foreign key): Identifier for the department that made the expense.\n* `amount` (decimal): The amount of money spent on the expense.\n* `date` (date): The date the expense was incurred.\n* `description` (varchar): A description of the expense.\n\nThe SQL query must filter the expenses based on two types of conditions described below:\n\n1) Description-Based Conditions:\n\n* This is indicated by the presence of specific keywords within the description field of the expenses table. The keywords to look for are:\n    * \"confetti\"\n    * \"glitter\"\n    * \"golden toilet\"\n    * \"massage chair\"\n    * \"video game\"\n    * \"karaoke\" \n\nThe analysis of the keywords should be case-insensitive.\n\n2) Date-Based Conditions:\n\n* Expenses that were recorded on specific dates that hold particular significance:\n    * April Fools’ Day (April 1st): Recognizing expenses that might have been made as part of practical jokes or humorous engagements on this day.\n    * Company’s Founding Anniversary (May 21st): Identifying spending that occurred on the anniversary of ABC Kata Solutions' founding, which might be related to celebration activities.\n    \nQuery must calculate the total spent by each department on these select expenses. \n\nThe results should be ordered first by the `total_questionable_expenses` in descending order, and secondarily by department name in descending alphabetical order to resolve any ties.\n\nOnly the top five departments should be listed in the final output.\n\nThe result should have only 2 colums: \n\n1) `department_name` (varchar): The name of the department responsible for the expense.\n2) `total_questionable_expenses` (money): The total amount spent by the department on specified extravagant items and during significant dates, aggregated across all matching records. The formatting and rounding is handled by PostgreSQL's `money` datatype.\n\nFor this sample data:\n\n```\ndepartments: \n\n| department_id| department_name |\n+--------------+-----------------+\n| 1            | Engineering     |\n| 2            | Marketing       |\n| 3            | Human Resources |\n| 4            | Finance         |\n| 5            | Sales           |\n```\n\n```\nexpenses:\n\n| expense_id| department_id| amount | date       | description                           |\n+-----------+--------------+--------+------------+---------------------------------------+\n| 1         | 1            | 500.0  | 2022-04-01 | confetti for product launch           |\n| 2         | 1            | 1200.0 | 2023-05-21 | golden toilet for new office          |\n| 3         | 2            | 300.0  | 2023-01-01 | Glitter bombs for ad campaign         |\n| 4         | 3            | 450.0  | 2022-04-01 | KARAOKE machine for office party      |\n| 5         | 4            | 2000.0 | 2023-05-21 | luxury massage chairs for finance     |\n| 6         | 5            | 800.0  | 2022-12-25 | video game console for sales team     |\n```\n\nthe desired output is the following:\n\n```\n| department_name | total_questionable_expenses |\n+-----------------+-----------------------------+\n| Finance         | $2,000.00                   |\n| Engineering     | $1,700.00                   |\n| Sales           | $800.00                     |\n| Human Resources | $450.00                     |\n| Marketing       | $300.00                     |\n```\n\nGLHF!\n\n\n\n\n",
  "totalAttempts": 1506,
  "totalCompleted": 218,
  "totalStars": 9,
  "voteScore": 47,
  "tags": [
    "SQL",
    "Databases"
  ],
  "contributorsWanted": true,
  "unresolved": {
    "issues": 0,
    "suggestions": 0
  }
}