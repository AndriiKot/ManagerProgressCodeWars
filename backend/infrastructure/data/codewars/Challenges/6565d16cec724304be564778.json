{
  "id": "6565d16cec724304be564778",
  "name": "Correcting an SQL Query :  Unexpected Data Inflation  and Null Value Anomalies",
  "slug": "correcting-an-sql-query-unexpected-data-inflation-and-null-value-anomalies",
  "category": "reference",
  "publishedAt": "2023-11-30T07:44:19.587Z",
  "approvedAt": "2023-12-05T07:58:41.315Z",
  "languages": [
    "sql"
  ],
  "url": "https://www.codewars.com/kata/6565d16cec724304be564778",
  "rank": {
    "id": -7,
    "name": "7 kyu",
    "color": "white"
  },
  "createdAt": "2023-11-28T11:39:24.195Z",
  "createdBy": {
    "username": "bornForThis",
    "url": "https://www.codewars.com/users/bornForThis"
  },
  "approvedBy": {
    "username": "dfhwze",
    "url": "https://www.codewars.com/users/dfhwze"
  },
  "description": "You are a computer science student interning at a dynamic online media company. The company hosts a popular platform where users can discuss a wide range of topics. Your project involves developing a feature that shows the total number of votes and visits for each topic on the site. This feature is intended to help the content team gauge user engagement and interest in different topics.\n\nChallenge: After deploying your initial SQL query for this feature, you notice the data doesn't seem right. The total votes and visits for topics are much higher than expected. Furthermore, you encountered a specific issue: when topics had no votes and no visits, the total votes are displayed as NULL instead of 0. This inconsistency occurs only when both votes and visits are zero; if there are visits but no votes, the total votes correctly show as 0.\n\nYou need to revise the SQL query to ensure it accurately calculates the total ratings and visits for each topic. \n\nInitial incorrect query: \n\n```sql\nselect topics.id, sum(votes.rating) as total_rating, count(visits.id) as total_visits\nfrom topics\nleft join visits on visits.content_id = topics.id\nleft join votes on votes.content_id = topics.id\ngroup by topics.id\norder by topics.id desc;\n```\n\nTable Schemas:\n\n`topics`:\n\n* `id` (int): Unique identifier for each topic.\n* `name` (varchar): The name of the topic.\n* `message` (varchar): A description or message of the topic.\n* `uid` (int): User ID of the topic creator.\n\n`votes`:\n\n* `id` (int): Unique identifier for each vote.\n* `rating` (tinyint): The rating given by the user (assumed to be a positive or negative vote).\n* `content_id` (int): The ID of the topic that the vote is associated with.\n* `uid` (int): User ID of the user who voted.\n\n`visits`:\n\n* `id` (int): Unique identifier for each visit.\n* `content_id` (int): The ID of the topic that was visited.\n* `uid` (int): User ID of the visitor.\n\n\nThe task is to revise the query to avoid the incorrect inflation of vote and visit counts, ensuring that the content team receives accurate data for their analysis. The output should still list the `topic.id`, followed by the total sum of votes' ratings, and the count of visits for each topic, ordered by `topic.id` in descending order. Query must handle cases where topics may have zero votes or/and visits ensuring the correct display of 0 instead of NULL for the total votes in such scenarios.\n\nGLHF!\n",
  "totalAttempts": 1067,
  "totalCompleted": 224,
  "totalStars": 9,
  "voteScore": 46,
  "tags": [
    "SQL",
    "Databases",
    "Refactoring"
  ],
  "contributorsWanted": true,
  "unresolved": {
    "issues": 0,
    "suggestions": 0
  }
}