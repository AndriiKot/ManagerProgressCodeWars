{
  "id": "64a53e4f2543b0000fac10ee",
  "name": "Employees and managers: part 5 (top subordinates by experience)",
  "slug": "employees-and-managers-part-5-top-subordinates-by-experience",
  "category": "reference",
  "publishedAt": "2023-07-05T09:56:36.020Z",
  "approvedAt": "2023-08-08T10:31:10.944Z",
  "languages": [
    "sql"
  ],
  "url": "https://www.codewars.com/kata/64a53e4f2543b0000fac10ee",
  "rank": {
    "id": -5,
    "name": "5 kyu",
    "color": "yellow"
  },
  "createdAt": "2023-07-05T09:56:31.378Z",
  "createdBy": {
    "username": "bornForThis",
    "url": "https://www.codewars.com/users/bornForThis"
  },
  "approvedBy": {
    "username": "dfhwze",
    "url": "https://www.codewars.com/users/dfhwze"
  },
  "description": "You have been provided with a PostgreSQL database that contains an `employees` table. The `employees` table has the following structure:\n\n* `id`: an integer column that uniquely identifies each employee.\n* `name`: a text column that contains the name of the employee.\n* `experience`: an integer column that contains total years of experience of an employee.\n* `manager_id`: an integer column that identifies the manager of each employee. The `manager_id` corresponds to an `id` in the same employees table. This means that our table has a recursive relationship with itself - an employee can be a manager to other employees. It is nullable: top managers do not have managers above them.\n\nA corporation is keen on understanding the distribution of experience within its teams. They hypothesize that a manager's experience relative to their most experienced direct subordinates can offer insights into the team's dynamics and identify opportunities for knowledge sharing and mentorship. A boolean indicator showing whether a manager's experience surpasses the average experience of their top 3 subordinates would help in this analysis.\n\nIn this kata you need to write a SQL query to first determine the top direct subordinates per manager (up to 3), and then calculate the average experience of these top subordinates.\n\nResultant data should display the following columns, in order:\n\n* `manager_id` - The ID of the manager.\n* `manager_name` - The name of the manager.\n* `manager_experience` - The experience of the manager, formatted as \"[experience] years\", where [experience] is the number of years of experience.\n* `subordinate_name` - The name of the subordinate, formatted as \"[name] ([rank])\", where [name] is the name of the subordinate and [rank] is their rank based on experience (from 1 to 3).\n* `subordinate_experience` - The experience of the subordinate, formatted as \"[experience] years\", where [experience] is the number of years of experience.\n* `subordinate_id` - The ID of the subordinate.\n* `is_manager_experience_higher` - A boolean field indicating whether the manager's experience is higher than the average experience of their top subordinates.\n\nThe query should fetch up to the top three subordinates under each manager, based on experience. If there are less than three subordinates for a manager, only the existing subordinates should be displayed, and the average experience should be calculated based on these subordinates.\n\nWhen sorting subordinates based on experience, in case of a tie, the subordinate with the lower employee ID should be ranked higher.\n\nThe resultant data should be sorted by `manager_id` and `rank` in ascending order.\n\nNotes:\n\n* Organization's management hierarchy does not have cyclic relationships. In other words, it is guaranteed that there will be no situations where an employee's chain of managers loops back on itself (e.g., A's manager is B, B's manager is C, and C's manager is A).\n\nGLHF!\n\n### Desired Output\n\nThe desired output should look like this:\n\n<table><!----><tr><th>manager_id</th><th>manager_name</th><th>manager_experience</th><th>subordinate_name</th><th>subordinate_experience</th><th>subordinate_id</th><th>is_manager_experience_higher</th></tr><tr><td>1</td><td>Ching Krajcik VM</td><td>18 years</td><td>Dillon Becker JD (1)</td><td>15 years</td><td>74</td><td>true</td></tr><tr><td>1</td><td>Ching Krajcik VM</td><td>18 years</td><td>Elroy Pagac (2)</td><td>5 years</td><td>67</td><td>true</td></tr><tr><td>2</td><td>Porsche Zemlak</td><td>15 years</td><td>Alejandro Beatty (1)</td><td>22 years</td><td>4</td><td>false</td></tr></table>\n...\n\n\n\n\n\n\n\n\n\n",
  "totalAttempts": 810,
  "totalCompleted": 138,
  "totalStars": 8,
  "voteScore": 32,
  "tags": [
    "SQL",
    "Databases"
  ],
  "contributorsWanted": true,
  "unresolved": {
    "issues": 0,
    "suggestions": 0
  }
}